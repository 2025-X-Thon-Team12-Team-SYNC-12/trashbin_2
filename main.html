<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dr. Prompt ë©”ì¸</title>

    <style>
        /* ===== ì „ì²´ ë°°ê²½ & ê¸°ë³¸ í°íŠ¸ (Dr. Prompt ë©”ì¸ ëŠë‚Œ) ===== */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            font-family: "system-ui", -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background: linear-gradient(
                180deg,
                rgba(255, 255, 255, 1) 16%,
                rgba(187, 255, 230, 1) 67%,
                rgba(151, 224, 255, 1) 85%,
                rgba(97, 155, 255, 1) 100%
            );
        }

        /* ì¤‘ì•™ì— Dr. Prompt ëœë”© ì„¹ì…˜ */
        .element {
            position: relative;
            width: 100%;
            min-width: 1280px;
            min-height: 800px;
            box-sizing: border-box;
        }

        .element .text-wrapper {
            position: absolute;
            top: 312px;
            left: 122px;
            font-weight: 400;
            color: #000000;
            font-size: 36px;
            line-height: 36px;
            white-space: nowrap;
        }

        /* ğŸ”¹ ì„¤ëª… ë¬¸ë‹¨: ê¸€ì”¨ í¬ê¸°ë§Œ ì¤„ì—¬ì„œ ë²„íŠ¼ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ */
        .element .div {
            position: absolute;
            top: 480px;
            left: 122px;
            width: 600px;
            font-weight: 400;
            color: #374151;
            font-size: 13px;      /* 14px â†’ 13px */
            letter-spacing: 0.1px;
            line-height: 18px;    /* 20px â†’ 18px */
        }

        .element .text-wrapper-2 {
            position: absolute;
            top: 367px;
            left: 111px;
            font-weight: 800;
            color: #1a1a1a;
            font-size: 100px;
            letter-spacing: -5px;
            line-height: 100px;
            white-space: nowrap;
        }

        /* ğŸ”¹ Team SYNC í…ìŠ¤íŠ¸: ìœ„/ì™¼ìª½ ê³ ì •, ì¦ê²¨ì°¾ê¸°ì™€ ì•ˆê²¹ì¹˜ê²Œ ì•½ê°„ ë‚´ë ¤ì¤Œ */
        .element .text-wrapper-3 {
            position: absolute;
            top: 70px;   /* 31px â†’ 70px */
            left: 32px;
            font-weight: 700;
            color: #000000;
            font-size: 16px;
            line-height: 19.2px;
            white-space: nowrap;
        }

        /* ìƒë‹¨ ë„¤ë¹„ */
        .element .navbar {
            display: inline-flex;
            align-items: center;
            gap: 20px;
            position: absolute;
            top: 21px;
            right: 40px;
        }

        .element .text-wrapper-4 {
            position: relative;
            width: fit-content;
            margin-top: -1px;
            font-size: 14px;
            color: #4b5563;
            white-space: nowrap;
            cursor: pointer;
        }

        /* ChatGPT / Gemini / Manual ë²„íŠ¼ (ê¸°ëŠ¥ ì—°ê²°) */
        .element .button-primary,
        .element .button-primary-2,
        .element .button-manual {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 22px;
            position: absolute;
            top: 569px;
            border-radius: 12px;
            box-shadow: 0 4px 12px #00000040;
            border: none;
            cursor: pointer;
        }

        .element .button-primary {
            left: 118px;
            background-color: #111827;
            color: #f9fafb;
        }

        .element .button-primary-2 {
            left: 386px;
            background-color: #e0f2fe;
            color: #1d6a8b;
        }

        /* ì„¸ ë²ˆì§¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .element .button-manual {
            left: 654px;
            background-color: #ffffff;
            color: #000000;
        }

        .element .bullet,
        .element .bullet-2,
        .element .bullet-3 {
            width: 4px;
            height: 4px;
            border-radius: 999px;
            background-color: #ffffff;
        }

        .element .bullet-2 {
            background-color: #22d3ee;
        }
        
        /* ì„¸ ë²ˆì§¸ ë²„íŠ¼ ë¶ˆë¦¿ í¬ì¸íŠ¸ ìƒ‰ìƒ */
        .element .bullet-3 {
            background-color: #ff9900; 
        }

        .element .request-a-demo,
        .element .request-a-demo-2 {
            margin: 0;
            font-size: 14px;
            white-space: nowrap;
        }

        /* ===== ìƒë‹¨ ê³ ì • UI : ì¦ê²¨ì°¾ê¸° / ë¡œê·¸ì•„ì›ƒ ===== */
        .top-left-ui {
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1001;
        }

        .top-right-ui {
            position: fixed;
            top: 12px;
            right: 12px;
            z-index: 1001;
        }

        .top-btn {
            padding: 8px 14px;
            border-radius: 999px;
            border: none;
            background-color: #4f46e5;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .top-btn:hover {
            background-color: #4338ca;
        }

        /* ===== ì¦ê²¨ì°¾ê¸° íŒ¨ë„ ===== */
        .favorite-panel {
            position: fixed;
            top: 80px;     /* 50px â†’ 80px : ì¦ê²¨ì°¾ê¸° ë¸”ë¡ì„ ì¡°ê¸ˆ ë‚´ë¦¼ */
            left: 12px;
            width: 260px;
            max-height: 60vh;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            padding: 12px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .favorite-panel.hidden {
            display: none;
        }

        .fav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .fav-title {
            font-size: 14px;
            font-weight: 700;
        }

        .fav-close {
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
        }

        .fav-list {
            overflow-y: auto;
            padding-right: 4px;
        }

        .fav-item {
            font-size: 13px;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 6px;
            white-space: pre-wrap;
        }

        /* ===== ê³µí†µ ëª¨ë‹¬ ===== */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .hidden {
            display: none;
        }

        .chat-window {
            width: 420px;
            max-width: 90vw;
            height: 80vh;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 10px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .chat-header-left {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .chat-subtitle {
            font-size: 11px;
            font-weight: 400;
            color: #6b7280;
        }

        .chat-close-btn {
            border: none;
            background: transparent;
            font-size: 18px;
            cursor: pointer;
        }

        .chat-messages {
            flex: 1;
            padding: 12px 16px;
            overflow-y: auto;
            font-size: 14px;
            background: #f9fafb;
        }

        .chat-input-area {
            padding: 10px;
            display: flex;
            gap: 8px;
            border-top: 1px solid #ddd;
        }

        .chat-input-area input {
            flex: 1;
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid #ccc;
        }

        .chat-send-btn {
            padding: 8px 14px;
            border-radius: 999px;
            background: #4f46e5;
            border: none;
            color: white;
            cursor: pointer;
        }

        .msg-row {
            display: flex;
            margin-bottom: 8px;
            align-items: flex-start;
        }

        .msg-user {
            justify-content: flex-end;
        }

        .msg-model {
            justify-content: flex-start;
        }

        /* ë§í’ì„  ê³µí†µ */
        .bubble {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            position: relative;
        }

        .bubble-content {
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .bubble-user {
            background: #4f46e5;
            color: white;
            border-bottom-right-radius: 2px;
        }

        .bubble-model-gemini {
            background: #e5e7eb;
            color: #111;
            border-bottom-left-radius: 2px;
        }

        .bubble-model-gpt {
            background: #fee2e2;
            color: #111;
            border-bottom-left-radius: 2px;
        }

        /* ë§í’ì„  í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ */
        .message-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 2px;
            padding-top: 4px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .action-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: inherit;
            opacity: 0.6;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-btn:hover {
            opacity: 1;
            background-color: rgba(255,255,255,0.2);
        }

        .action-btn svg {
            width: 16px;
            height: 16px;
        }

        .bubble-user .message-actions {
            border-top-color: rgba(255,255,255,0.2);
        }

        /* ëª¨ë¸ ì„ íƒ í–‰ */
        .model-select-row {
            padding: 10px 16px;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 13px;
        }

        /* ===== ì¦ê²¨ì°¾ê¸° ë³„ì„ ë§í’ì„  'ì˜†ì—' ë†“ê¸° ìœ„í•œ ìŠ¤íƒ€ì¼ ===== */
        .msg-model .fav-wrapper {
            display: flex;
            align-items: center;
            margin-left: 6px;
        }

        .favorite-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .favorite-btn svg {
            width: 20px;
            height: 20px;
        }

        /* ===== í† ìŠ¤íŠ¸ ì•Œë¦¼ ===== */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
            bottom: 50px;
        }
    </style>
</head>
<body>

    <div class="top-left-ui">
        <button class="top-btn" onclick="openFavoritePanel()">â­ ì¦ê²¨ì°¾ê¸° ëª©ë¡</button>
    </div>

    <div class="top-right-ui">
        <button class="top-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div id="favoritePanel" class="favorite-panel hidden">
        <div class="fav-header">
            <span class="fav-title">â­ ì¦ê²¨ì°¾ê¸°</span>
            <button class="fav-close" onclick="closeFavoritePanel()">âœ•</button>
        </div>
        <div id="favoriteList" class="fav-list"></div>
    </div>

    <div class="element">
        <div class="text-wrapper-3">Team SYNC : 12</div>

        <div class="navbar">
            <div class="text-wrapper-4" onclick="window.open('guide.html','_blank')">Guide</div>
        </div>

        <div class="text-wrapper">AI í”„ë¡¬í”„íŠ¸ ì‘ì„± ë„ìš°ë¯¸</div>

        <p class="div">
            Dr. Prompt ì„œë¹„ìŠ¤ëŠ” ì²­ë…„ì˜ AI í™œìš© ì—­ëŸ‰ ê°•í™”ë¥¼ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì½”ì¹­ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
            ë³¸ ì„œë¹„ìŠ¤ëŠ” ë‹¨ìˆœíˆ í”„ë¡¬í”„íŠ¸ë¥¼ ëŒ€ì‹  ì‘ì„±í•´ ì£¼ëŠ” ê²ƒì„ ë„˜ì–´, â€œë§¥ë½â€, â€œì—­í• â€, â€œêµ¬ì²´ì„±â€ì„ ì§„ë‹¨í•˜ì—¬
            í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì²­ë…„ë“¤ì˜ AI ë¦¬í„°ëŸ¬ì‹œ ê²©ì°¨ë¥¼ ì¤„ì—¬ ë‚˜ì•„ê°€
            AI ë„¤ì´í‹°ë¸Œ ì¸ì¬ë¡œ ì„±ì¥í•˜ëŠ” ëª©í‘œë¥¼ ê°€ì§‘ë‹ˆë‹¤.
        </p>

        <div class="text-wrapper-2">Dr. Prompt</div>

        <button class="button-primary" onclick="openGptChat()">
            <div class="bullet"></div>
            <p class="request-a-demo">ChatGPT í”„ë¡¬í”„íŠ¸ ì‘ì„± ë°”ë¡œê°€ê¸°</p>
        </button>

        <button class="button-primary-2" onclick="openGeminiChat()">
            <div class="bullet-2"></div>
            <div class="request-a-demo-2">Gemini í”„ë¡¬í”„íŠ¸ ì‘ì„± ë°”ë¡œê°€ê¸°</div>
        </button>

        <!-- Prompt ì„¤ëª…ì„œ ë²„íŠ¼: guide.html ë¡œ ì´ë™ -->
        <button class="button-manual" onclick="window.location.href='guide.html'">
            <div class="bullet-3"></div>
            <p class="request-a-demo">Prompt ì„¤ëª…ì„œ</p>
        </button>
    </div>

    <!-- ===== Gemini ëª¨ë‹¬ ===== -->
    <div id="gemOverlay" class="overlay hidden">
        <div class="chat-window">
            <div class="chat-header">
                <div class="chat-header-left">
                    <span>Gemini ëŒ€í™”</span>
                    <span class="chat-subtitle">ëŒ€í•™ìƒ ë©˜í† ë§ AI</span>
                </div>
                <button class="chat-close-btn" onclick="closeGeminiChat()">âœ•</button>
            </div>

            <div class="model-select-row">
                <span>ëª¨ë¸ ì„ íƒ:</span>
                <select id="geminiModelSelect" onchange="onGeminiModelChange(this.value)">
                    <option value="flash">Gemini Flash</option>
                    <option value="thinking">Gemini Thinking</option>
                </select>
            </div>

            <div id="gemMessages" class="chat-messages"></div>

            <div class="chat-input-area">
                <input id="gemInput" type="text"
                    onkeydown="if(event.key === 'Enter') sendGeminiMessage();"
                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button class="chat-send-btn" onclick="sendGeminiMessage()">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <!-- ===== GPT ëª¨ë‹¬ ===== -->
    <div id="gptOverlay" class="overlay hidden">
        <div class="chat-window">
            <div class="chat-header">
                <div class="chat-header-left">
                    <span>GPT ëŒ€í™”</span>
                    <span class="chat-subtitle">ëª¨ë¸ì„ ì„ íƒí•´ ëŒ€í™”í•˜ì„¸ìš”</span>
                </div>
                <button class="chat-close-btn" onclick="closeGptChat()">âœ•</button>
            </div>

            <div class="model-select-row">
                <span>ëª¨ë¸ ì„ íƒ:</span>
                <select id="gptModelSelect" onchange="onGptModelChange(this.value)">
                    <option value="instant">GPT-5 Instant</option>
                    <option value="thinking">GPT-5 Thinking</option>
                </select>
            </div>

            <div id="gptMessages" class="chat-messages"></div>

            <div class="chat-input-area">
                <input id="gptInput" type="text"
                    onkeydown="if(event.key === 'Enter') sendGptMessage();"
                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button class="chat-send-btn" onclick="sendGptMessage()">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCoTBN7K4orUZtTTp_P4cGP8wmSPgyR7GM",
            authDomain: "team-sync-a82e3.firebaseapp.com",
            projectId: "team-sync-a82e3",
            storageBucket: "team-sync-a82e3.firebasestorage.app",
            messagingSenderId: "239977699662",
            appId: "1:239977699662:web:ea9d1a7f90381143e2e61f",
            measurementId: "G-X3G15GWG5V"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        /* ===== í† ìŠ¤íŠ¸ ===== */
        function showToast(message) {
            const toast = document.createElement("div");
            toast.className = "toast";
            toast.textContent = message;
            document.body.appendChild(toast);

            requestAnimationFrame(() => {
                toast.classList.add("show");
            });

            setTimeout(() => {
                toast.classList.remove("show");
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2000);
        }

        /* ===== ë¡œê·¸ì•„ì›ƒ ===== */
        async function logout() {
            try {
                await signOut(auth);
            } catch (e) {
                console.error("signOut error:", e);
            }
            localStorage.removeItem("currentUser");
            showToast("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            setTimeout(() => {
                window.location.href = "login.html";
            }, 800);
        }

        /* ===== ì¦ê²¨ì°¾ê¸° íŒ¨ë„ ===== */
        function openFavoritePanel() {
            const panel = document.getElementById("favoritePanel");
            panel.classList.remove("hidden");
            renderFavoriteList();
        }

        function closeFavoritePanel() {
            const panel = document.getElementById("favoritePanel");
            panel.classList.add("hidden");
        }

        function deleteFavorite(messageId){
            let fav = JSON.parse(localStorage.getItem("favorites")) || [];

            fav = fav.filter(item => item.id !== messageId);

            localStorage.setItem("favorites", JSON.stringify(fav));

            showToast("ì¦ê²¨ì°¾ê¸°ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");

            // ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§
            renderFavoriteList();
        }
        
        function renderFavoriteList() {
            const listEl = document.getElementById("favoriteList");
            const favs = JSON.parse(localStorage.getItem("favorites")) || [];

            if (favs.length > 0 && typeof favs[0] === "string") {
                localStorage.removeItem("favorites");
                listEl.innerHTML =
                    "<div style='font-size:13px; color:#6b7280;'>ë°ì´í„° í˜•ì‹ì´ ë³€ê²½ë˜ì–´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</div>";
                return;
            }

            listEl.innerHTML = "";

            if (favs.length === 0) {
                listEl.innerHTML =
                    "<div style='font-size:13px; color:#6b7280;'>ì¦ê²¨ì°¾ê¸°í•œ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
                return;
            }

            favs.forEach(item => {
                const itemDiv = document.createElement("div");
                itemDiv.className = "fav-item";

                //ìˆ˜ì •
                const textSpan = document.createElement("span");
                textSpan.textContent = item.text || "(í…ìŠ¤íŠ¸ ì—†ìŒ)";
                textSpan.style.flex = "1";

                //ì‚­ì œ ë²„íŠ¼
                const deleteBtn=document.createElement("button");
                deleteBtn.innerHTML="ğŸ—‘ï¸";
                deleteBtn.style.marginLeft = "8px";
                deleteBtn.style.cursor = "pointer";
                deleteBtn.style.border = "none";
                deleteBtn.style.background = "transparent";
                deleteBtn.style.fontSize = "16px";

                deleteBtn.addEventListener("click", () => {
                    deleteFavorite(item.id);
                });

                itemDiv.appendChild(textSpan);
                itemDiv.appendChild(deleteBtn);

                listEl.appendChild(itemDiv);
            });
        }

        /* ===== í´ë¦½ë³´ë“œ ë³µì‚¬ ===== */
        function copyTextToClipboard(text) {
            if (!navigator.clipboard) {
                const textarea = document.createElement("textarea");
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand("copy");
                document.body.removeChild(textarea);
                showToast("í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹");
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                showToast("í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹");
            }).catch(err => {
                console.error("ë³µì‚¬ ì‹¤íŒ¨:", err);
                showToast("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ğŸ˜¢");
            });
        }

        /* ===== ë¡œê·¸ì¸ / ì¦ê²¨ì°¾ê¸° ìœ í‹¸ ===== */
        function isLoggedIn() {
            return !!localStorage.getItem("currentUser");
        }

        function toggleFavorite(messageId, text) {
            if (!isLoggedIn()) {
                showToast("ë¡œê·¸ì¸ í›„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤!");
                return null;
            }

            let fav = JSON.parse(localStorage.getItem("favorites")) || [];

            if (fav.length > 0 && typeof fav[0] === "string") {
                fav = [];
            }

            const existingIndex = fav.findIndex(item => item.id === messageId);

            if (existingIndex !== -1) {
                fav.splice(existingIndex, 1);
                localStorage.setItem("favorites", JSON.stringify(fav));
                showToast("ì¦ê²¨ì°¾ê¸°ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.");
                return false;
            } else {
                fav.push({ id: messageId, text: text });
                localStorage.setItem("favorites", JSON.stringify(fav));
                showToast("ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                return true;
            }
        }

        function isFavorite(messageId) {
            let fav = JSON.parse(localStorage.getItem("favorites")) || [];
            if (fav.length > 0 && typeof fav[0] === "string") return false;
            return fav.some(item => item.id === messageId);
        }

        /* ===== ê³µí†µ ìœ ì € ë§í’ì„  ===== */
        function addUserMessage(container, text) {
            const row = document.createElement("div");
            row.className = "msg-row msg-user";

            const bubble = document.createElement("div");
            bubble.className = "bubble bubble-user";
            bubble.textContent = text;

            row.appendChild(bubble);
            container.appendChild(row);
            container.scrollTop = container.scrollHeight;
        }

        /* ===== Gemini ===== */
        const gemOverlay = document.getElementById("gemOverlay");
        const gemInput = document.getElementById("gemInput");
        const gemMessages = document.getElementById("gemMessages");
        const geminiModelSelect = document.getElementById("geminiModelSelect");
        let currentGeminiType = "flash";

        function openGeminiChat() {
            gemOverlay.classList.remove("hidden");
            gemMessages.innerHTML = "";
            currentGeminiType = geminiModelSelect.value || "flash";
            addGeminiMessage(`ì•ˆë…•í•˜ì„¸ìš”! Gemini ë©˜í† ì…ë‹ˆë‹¤.\ní˜„ì¬ ì„ íƒëœ ëª¨ë¸: ${currentGeminiType}`);
            gemInput.focus();
        }

        function closeGeminiChat() {
            gemOverlay.classList.add("hidden");
        }

        function onGeminiModelChange(value) {
            currentGeminiType = value;
            addGeminiMessage(`ëª¨ë¸ì´ '${value}' ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function addGeminiMessage(text, originalPrompt = null) {
            const row = document.createElement("div");
            row.className = "msg-row msg-model";

            const messageId =
                "gem_" + Date.now() + "_" + Math.random().toString(36).slice(2);

            const bubble = document.createElement("div");
            bubble.className = "bubble bubble-model-gemini";

            const contentDiv = document.createElement("div");
            contentDiv.className = "bubble-content";
            contentDiv.textContent = text;
            bubble.appendChild(contentDiv);

            const actionsDiv = document.createElement("div");
            actionsDiv.className = "message-actions";

            const copyBtn = document.createElement("button");
            copyBtn.className = "action-btn";
            copyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" 
                     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3
                             c-1.03 0-1.9.693-2.166 1.638m7.332 0
                             c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9
                             a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612
                             m7.332 0c.646.049 1.288.11 1.927.184
                             1.1.128 1.907 1.077 1.907 2.185V19.5
                             a2.25 2.25 0 01-2.25 2.25H6.75
                             A2.25 2.25 0 014.5 19.5V6.257
                             c0-1.108.806-2.057 1.907-2.185
                             a48.208 48.208 0 011.927-.184" />
                </svg>`;
            copyBtn.onclick = () => copyTextToClipboard(text);
            actionsDiv.appendChild(copyBtn);

            if (originalPrompt) {
                const retryBtn = document.createElement("button");
                retryBtn.className = "action-btn";
                retryBtn.title = "ë‹¤ì‹œ ìƒì„±í•˜ê¸°";
                retryBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                         viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992
                                 m0 0h4.992m-4.993 0 3.181 3.183
                                 a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865
                                 a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182
                                 m0-4.991v4.99" />
                    </svg>`;
                retryBtn.onclick = () => {
                    if (confirm("ê°™ì€ ì§ˆë¬¸ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        sendGeminiMessage(originalPrompt);
                    }
                };
                actionsDiv.appendChild(retryBtn);
            }

            bubble.appendChild(actionsDiv);

            const favWrapper = document.createElement("div");
            favWrapper.className = "fav-wrapper";

            const favBtn = document.createElement("button");
            favBtn.className = "favorite-btn";

            function renderStar() {
                if (isFavorite(messageId)) {
                    favBtn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="gold" stroke="gold" stroke-width="1.5">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.9L18.18 22 
                                     12 18.3 5.82 22 7 14.17l-5-4.9 6.91-1.01z"/>
                        </svg>`;
                } else {
                    favBtn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="1.8">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.9L18.18 22 
                                     12 18.3 5.82 22 7 14.17l-5-4.9 6.91-1.01z"/>
                        </svg>`;
                }
            }

            renderStar();

            favBtn.onclick = () => {
                const result = toggleFavorite(messageId, text);
                if (result !== null) {
                    renderStar();
                    const panel = document.getElementById("favoritePanel");
                    if (!panel.classList.contains("hidden")) {
                        renderFavoriteList();
                    }
                }
            };

            favWrapper.appendChild(favBtn);

            row.appendChild(bubble);
            row.appendChild(favWrapper);

            gemMessages.appendChild(row);
            gemMessages.scrollTop = gemMessages.scrollHeight;
        }

        const SERVER_URL = "https://lickerishly-unmedaled-zona.ngrok-free.dev";

/* Gemini ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜ (ìµœì¢…_ì§„ì§œ_ì™„ì„±.ver) */
        async function sendGeminiMessage(textOverride) {
            // 1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸° (ì¬ìƒì„± ë²„íŠ¼ì´ë©´ textOverride, ì•„ë‹ˆë©´ ì…ë ¥ì°½)
            const text = textOverride ?? gemInput.value.trim();
            if (!text) return;

            // 2. ë‚´ ë§í’ì„  í™”ë©´ì— ì¶”ê°€
            addUserMessage(gemMessages, text);
            
            // 3. ì§ì ‘ ì…ë ¥í•œ ê²½ìš°ì—ë§Œ ì…ë ¥ì°½ ë¹„ìš°ê¸° (ì¬ìƒì„± ë²„íŠ¼ì¼ ë• ìœ ì§€)
            if (!textOverride) {
                gemInput.value = "";
                gemInput.focus();
            }

        
            // 4. ì§„ì§œ ì„œë²„(FastAPI)ë¡œ ìš”ì²­ ë³´ë‚´ê¸°
            try {
                const res = await fetch(SERVER_URL+"/gemini_mentor", {
                    method: "POST",
                    headers: {"Content-Type":"application/json"},
                    // í˜„ì¬ ì„ íƒëœ ëª¨ë¸(flash/thinking) ì •ë³´ë„ ê°™ì´ ë³´ëƒ„
                    body: JSON.stringify({ 
                        text: text, 
                        bot_type: currentGeminiType 
                    })
                });
                
                const data = await res.json();
                
                // 5. AI ì‘ë‹µ ì¶œë ¥ 
                // (ì¤‘ìš”: ë‘ ë²ˆì§¸ ì¸ìë¡œ 'text'ë¥¼ ë„˜ê²¨ì•¼ ì¬ì‹œë„ ë²„íŠ¼ì´ ì‘ë™í•¨!)
                addGeminiMessage(data.reply || "(ì‘ë‹µ ì—†ìŒ)", text);
                
            } catch(e) {
                console.error(e);
                addGeminiMessage("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", null);
            }
        }

        /* ===== GPT ===== */
        const gptOverlay = document.getElementById("gptOverlay");
        const gptInput = document.getElementById("gptInput");
        const gptMessages = document.getElementById("gptMessages");
        const gptModelSelect = document.getElementById("gptModelSelect");
        let currentBotType = "instant";

        function openGptChat() {
            gptOverlay.classList.remove("hidden");
            gptMessages.innerHTML = "";
            currentBotType = gptModelSelect.value || "instant";
            addGptMessage(`ì•ˆë…•í•˜ì„¸ìš”! GPT ë©˜í† ì…ë‹ˆë‹¤.\ní˜„ì¬ ì„ íƒëœ ëª¨ë¸: ${currentBotType}`);
            gptInput.focus();
        }

        function closeGptChat() {
            gptOverlay.classList.add("hidden");
        }

        function onGptModelChange(value) {
            currentBotType = value;
            addGptMessage(`ëª¨ë¸ì´ '${value}' ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function addGptMessage(text, originalPrompt = null) {
            const row = document.createElement("div");
            row.className = "msg-row msg-model";

            const messageId =
                "gpt_" + Date.now() + "_" + Math.random().toString(36).slice(2);

            const bubble = document.createElement("div");
            bubble.className = "bubble bubble-model-gpt";

            const contentDiv = document.createElement("div");
            contentDiv.className = "bubble-content";
            contentDiv.textContent = text;
            bubble.appendChild(contentDiv);

            const actionsDiv = document.createElement("div");
            actionsDiv.className = "message-actions";

            const copyBtn = document.createElement("button");
            copyBtn.className = "action-btn";
            copyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" 
                     viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3
                             c-1.03 0-1.9.693-2.166 1.638m7.332 0
                             c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9
                             a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612
                             m7.332 0c.646.049 1.288.11 1.927.184
                             1.1.128 1.907 1.077 1.907 2.185V19.5
                             a2.25 2.25 0 01-2.25 2.25H6.75
                             A2.25 2.25 0 014.5 19.5V6.257
                             c0-1.108.806-2.057 1.907-2.185
                             a48.208 48.208 0 011.927-.184" />
                </svg>`;
            copyBtn.onclick = () => copyTextToClipboard(text);
            actionsDiv.appendChild(copyBtn);

            if (originalPrompt) {
                const retryBtn = document.createElement("button");
                retryBtn.className = "action-btn";
                retryBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                         viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992
                                 m0 0h4.992m-4.993 0 3.181 3.183
                                 a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865
                                 a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182
                                 m0-4.991v4.99" />
                    </svg>`;
                retryBtn.onclick = () => {
                    if (confirm("ê°™ì€ ì§ˆë¬¸ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        sendGptMessage(originalPrompt);
                    }
                };
                actionsDiv.appendChild(retryBtn);
            }

            bubble.appendChild(actionsDiv);

            const favWrapper = document.createElement("div");
            favWrapper.className = "fav-wrapper";

            const favBtn = document.createElement("button");
            favBtn.className = "favorite-btn";

            function renderStar() {
                if (isFavorite(messageId)) {
                    favBtn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="gold" stroke="gold" stroke-width="1.5">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.9L18.18 22 
                                     12 18.3 5.82 22 7 14.17l-5-4.9 6.91-1.01z"/>
                        </svg>`;
                } else {
                    favBtn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="1.8">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.9L18.18 22 
                                     12 18.3 5.82 22 7 14.17l-5-4.9 6.91-1.01z"/>
                        </svg>`;
                }
            }

            renderStar();

            favBtn.onclick = () => {
                const result = toggleFavorite(messageId, text);
                if (result !== null) {
                    renderStar();
                    const panel = document.getElementById("favoritePanel");
                    if (!panel.classList.contains("hidden")) {
                        renderFavoriteList();
                    }
                }
            };

            favWrapper.appendChild(favBtn);

            row.appendChild(bubble);
            row.appendChild(favWrapper);

            gptMessages.appendChild(row);
            gptMessages.scrollTop = gptMessages.scrollHeight;
        }

/* GPT ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜ (ìˆ˜ì •ë¨) */
        async function sendGptMessage(textOverride) {
            // 1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸° (ì¬ìƒì„± ë²„íŠ¼ì´ë©´ textOverride, ì•„ë‹ˆë©´ ì…ë ¥ì°½)
            const text = textOverride ?? gptInput.value.trim();
            if (!text) return;

            // 2. ë‚´ ë§í’ì„  í™”ë©´ì— ì¶”ê°€
            addUserMessage(gptMessages, text);
            
            // 3. ì§ì ‘ ì…ë ¥í•œ ê²½ìš°ì—ë§Œ ì…ë ¥ì°½ ë¹„ìš°ê¸°
            if (!textOverride) {
                gptInput.value = "";
                gptInput.focus();
            }

            // 4. ì§„ì§œ ì„œë²„(FastAPI)ë¡œ ìš”ì²­ ë³´ë‚´ê¸°
            try {
                const res = await fetch(SERVER_URL+"/gpt_mentor", {
                    method: "POST",
                    headers: {"Content-Type":"application/json"},
                    // í˜„ì¬ ì„ íƒëœ GPT ëª¨ë¸(instant/thinking) ì •ë³´ë„ ê°™ì´ ë³´ëƒ„
                    body: JSON.stringify({
                        text: text,
                        bot_type: currentBotType 
                    })
                });
                
                const data = await res.json();
                
                // 5. AI ì‘ë‹µ ì¶œë ¥ 
                // (ì¤‘ìš”: ë‘ ë²ˆì§¸ ì¸ìë¡œ 'text'ë¥¼ ë„˜ê²¨ì•¼ ì¬ì‹œë„ ë²„íŠ¼ì´ ì‘ë™í•¨!)
                addGptMessage(data.reply || "(ì‘ë‹µ ì—†ìŒ)", text);
                
            } catch(e) {
                console.error(e);
                addGptMessage("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", null);
            }
        }

        /* ===== ì „ì—­ì— ì—°ê²° (onclickì—ì„œ ì‚¬ìš©) ===== */
        window.logout = logout;
        window.openFavoritePanel = openFavoritePanel;
        window.closeFavoritePanel = closeFavoritePanel;
        window.openGeminiChat = openGeminiChat;
        window.closeGeminiChat = closeGeminiChat;
        window.onGeminiModelChange = onGeminiModelChange;
        window.sendGeminiMessage = sendGeminiMessage;
        window.openGptChat = openGptChat;
        window.closeGptChat = closeGptChat;
        window.onGptModelChange = onGptModelChange;
        window.sendGptMessage = sendGptMessage;
    </script>
</body>
</html>
